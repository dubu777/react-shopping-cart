# # TDD 사고 방식으로 문제 분석하기

## ## 1. 목적 명확화: 결국 뭘 하려고 하는 거지?

주문 확인 페이지에서 ‘쿠폰 적용’ 기능을 개발하는 것
이 기능을 개발하기 위해 문제의 단위를 잘개 쪼개고, 각 문제를 TDD로 정복해 나가는 것

## ## 2. 핵심 기능 1줄 정의

쿠폰이 유효한지 검사하고, 현재 주문에 적용할 수 있는 쿠폰인지 확인하고, 쿠폰 적용 시 할인 금액을 계산하는 것

## ## 3. 세부 기능 정의

- 쿠폰 목록 불러오기: 쿠폰 목록을 불러온다.
- 쿠폰 유효성 검사: 쿠폰이 만료되었는지 확인한다.
- 쿠폰 적용 조건 검사: 쿠폰 적용 조건을 검사한다.
  - 세부 적용 조건
    - 최소 주문 금액 만족 여부 검사
    - 주문 수량 만족 여부 검사
    - 사용 가능 시간 만족 여부 검사
- 쿠폰 적용: 쿠폰을 적용하고 할인 금액을 계산한다.
  - 세부 할인 정보
    - 고정 할인 금액 계산
    - 비율 할인 금액 계산
    - BOGO 할인 계산
    - 무료 배송 할인 적용
  - 쿠폰 중복 적용: 최대 2개의 쿠폰을 적용할 수 있으며, 할인 금액이 큰 순서로 적용하여 최종 금액을 계산한다.
- UI: 주문 확인 및 쿠폰 적용을 할 수 있는 UI를 보여준다.
  - 주문 확인 페이지
  - 쿠폰 적용 모달

## ## 4. 개발 순서 계획

1. 쿠폰 목록 불러오기: API(`/coupons`) 호출
2. 쿠폰 유효성 검사: 쿠폰 만료 여부
3. 쿠폰 적용 조건 검사
   1. 최소 주문 금액
4. 쿠폰 적용
   1. 고정 할인 (할인 금액 계산 → 쿠폰 적용)
5. UI
   1. 주문 확인 페이지
   2. 쿠폰 적용 모달
6. UI 로직 x 비즈니스 로직
7. 배포 v0.0.1
8. 쿠폰 적용 조건 검사 & 할인 금액 계산 & 쿠폰 적용
   1. 사용 가능 시간 검사
   2. 주문 수량 검사
   3. 비율 할인 적용
   4. 무료 배송 할인 적용
   5. BOGO 할인 적용
9. 쿠폰 중복 적용: 할인 금액이 큰 순서로 적용

---

# # 미션 구현 진행

위 개발 순서 계획을 기반으로 미션을 진행하되, 변수에 **유연하게 대응**한다.

- [x] 쿠폰 목록 불러오기: API(`/coupons`) 호출
  - 테스트 케이스:
    [x] API 호출에 성공하면 쿠폰 목록을 반환한다.
    [x] API 호출에 실패하면 적절한 에러 메시지를 반환한다.
- [x] 쿠폰 유효성 검사: 쿠폰 만료 여부
  - 테스트 케이스:
    [x] 현재 날짜가 만료 날짜 이전이면 유효한 쿠폰으로 간주한다.
    [x] 현재 날짜가 만료 날짜 이후이면 만료된 쿠폰으로 간주한다.
- [x] 쿠폰 적용 조건 검사
  - [x] 최소 주문 금액
    - 테스트 케이스:
      [x] 장바구니의 총 금액이 최소 주문 금액 이상이면 쿠폰을 적용할 수 있다.
      [x] 장바구니의 총 금액이 최소 주문 금액 미만이면 쿠폰을 적용할 수 없다.
  - [x] 주문 수량
    - 테스트 케이스:
      1. 장바구니의 주문 수량이 조건을 충족하면 쿠폰을 적용할 수 있다.
      2. 장바구니의 주문 수량이 조건을 충족하지 않으면 쿠폰을 적용할 수 없다.
  - [x] 사용 가능 시간
    - 테스트 케이스:
      1. 현재 시간이 사용 가능 시간 범위 내에 있으면 쿠폰을 적용할 수 있다.
      2. 현재 시간이 사용 가능 시간 범위 외에 있으면 쿠폰을 적용할 수 없다.
- [x] 쿠폰 할인 금액 계산
  - [x] 고정 할인
    - 테스트 케이스:
      - [x] 쿠폰 적용 가능 조건이 없으면, 할인 금액을 반환한다.
      - [x] 쿠폰에 최소 주문 금액 조건이 있고 해당 조건을 만족하면, 할인 금액을 반환한다.
      - [x] 쿠폰에 최소 주문 금액 조건이 있고 해당 조건을 만족하지 못하면, 0을 반환한다.
      - [x] 쿠폰에 사용 가능 시간 조건이 있고 해당 조건을 만족하면, 할인 금액을 반환한다.
      - [x] 쿠폰에 사용 가능 시간 조건이 있고 해당 조건을 만족하지 못하면, 0을 반환한다.
      - [x] 쿠폰에 사용 가능 시간 조건과 사용 가능 시간 조건이 있고 해당 조건을 만족하면, 할인 금액을 반환한다.
      - [x] 쿠폰에 사용 가능 시간 조건과 사용 가능 시간 조건이 있고 해당 조건을 만족하지 못하면, 0을 반환한다.
  - [x] 비율 할인
  - [x] BOGO 할인
  - [x] 무료 배송 할인
- [x] 쿠폰 적용
  - [x] 고정 할인
    - 테스트 케이스:
      - [x] 초기 currentDiscountAmount는 0
      - [x] toggleSelection 실행 → coupons의 isSelected 속성 토글, currentDisCountAmount 값 재계산
      - [x] applySelectedCoupons
  - [x] 비율 할인
    - 테스트 케이스:
      1. 비율 할인 금액이 올바르게 계산된다.
  - [x] BOGO 할인
    - 테스트 케이스:
      1. BOGO 할인 조건이 충족되면 올바르게 적용된다.
  - [x] 무료 배송 할인
    - 테스트 케이스:
      1. 무료 배송이 올바르게 적용된다.
      2. 주문 금액이 100,000원 이상인 경우 무료 배송 할인을 적용할 수 없다.
  - [x] 쿠폰 중복 적용
    - 테스트 케이스:
      1. 쿠폰 중복 적용 조건의 기준은 주문 금액(이전 쿠폰 적용 전)이다.
         1. 주문 금액이 5만원인 경우, 무료 배송 할인과 미라클모닝 할인 모두 받을 수 있다.
      2. 적용 순서에 따라 할인 금액 계산 결과가 다르면, 더 할인 금액이 큰 순서로 적용한 할인 결과가 적용된다.
- [x] UI
  - [x] 주문 확인 페이지
  - [x] 쿠폰 적용 모달 (custom library)
- [x] UI 로직 x 비즈니스 로직
